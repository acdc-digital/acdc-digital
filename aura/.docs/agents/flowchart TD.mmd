flowchart TD
    %% User Interactions
    User[ğŸ‘¤ User] --> Dashboard[ğŸ“Š Dashboard Interface]
    
    %% Main System Components
    Dashboard --> AgentRegistry[ğŸ¢ Agent Registry]
    AgentRegistry --> AgentStore[ğŸ’¾ Agent Store<br/>Zustand State]
    
    %% Available Agents
    subgraph Agents [ğŸ¤– Available Agents]
        direction TB
        FileAgent[ğŸ“ File Creator Agent<br/>Creates files and content]
        ProjectAgent[ğŸ“‹ Project Creator Agent<br/>Creates and manages projects]
        InstructionsAgent[ğŸ“– Instructions Agent<br/>Processes instructions]
        SchedulingAgent[â° Scheduling Agent<br/>Handles scheduling tasks]
        TwitterAgent[ğŸ¦ Twitter Agent<br/>Social media automation]
        PreviewAgent[ğŸ‘ï¸ Preview Agent<br/>Brand identity preview]
    end
    
    %% Agent Registry manages all agents
    AgentRegistry -.-> Agents
    
    %% Data Flow
    subgraph DataLayer [ğŸ’¾ Data Layer - Convex Backend]
        direction TB
        ConvexDB[(ğŸ—„ï¸ Convex Database)]
        Projects[ğŸ“‹ Projects Table]
        Files[ğŸ“„ Files Table]
        Users[ğŸ‘¥ Users Table]
        Guidelines[ğŸ“š Identity Guidelines Table]
        
        ConvexDB --> Projects
        ConvexDB --> Files
        ConvexDB --> Users
        ConvexDB --> Guidelines
    end
    
    %% Agent Execution Flow
    User --> |1. User Action| AgentRegistry
    AgentRegistry --> |2. Route to Agent| FileAgent
    AgentRegistry --> |2. Route to Agent| ProjectAgent
    AgentRegistry --> |2. Route to Agent| PreviewAgent
    AgentRegistry --> |2. Route to Agent| InstructionsAgent
    AgentRegistry --> |2. Route to Agent| SchedulingAgent
    AgentRegistry --> |2. Route to Agent| TwitterAgent
    
    %% Agents interact with data
    FileAgent --> |3. Create/Update| DataLayer
    ProjectAgent --> |3. Create/Update| DataLayer
    PreviewAgent --> |3. Read Guidelines| DataLayer
    InstructionsAgent --> |3. Process| DataLayer
    SchedulingAgent --> |3. Schedule| DataLayer
    TwitterAgent --> |3. Post Content| DataLayer
    
    %% Results back to user
    DataLayer --> |4. Updated Data| Dashboard
    Dashboard --> |5. UI Update| User
    
    %% Preview Specific Flow
    subgraph PreviewFlow [ğŸ‘ï¸ Preview Agent Workflow]
        direction LR
        PreviewBtn[ğŸ”˜ Preview Button] --> PreviewToggle[ğŸ”„ Toggle Preview Mode]
        PreviewToggle --> LoadGuidelines[ğŸ“š Load Identity Guidelines]
        LoadGuidelines --> GeneratePreview[ğŸ“„ Generate Brand Preview]
        GeneratePreview --> DisplayPreview[ğŸ‘ï¸ Display Preview Document]
    end
    
    %% Connect preview flow
    User --> PreviewBtn
    PreviewAgent --> PreviewFlow
    PreviewFlow --> Guidelines
    
    %% State Management
    subgraph StateManagement [âš¡ State Management - Zustand]
        direction TB
        UIStore[ğŸ¨ UI Store<br/>Interface state]
        EditorStore[âœï¸ Editor Store<br/>Editor state]
        SidebarStore[ğŸ“± Sidebar Store<br/>Sidebar state]
        IdentityStore[ğŸ“ Identity Guidelines Store<br/>Preview mode, sections]
    end
    
    Dashboard --> StateManagement
    StateManagement --> Dashboard
    
    %% Styling
    classDef userNode fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef agentNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef dataNode fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef stateNode fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef previewNode fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    
    class User,Dashboard userNode
    class AgentRegistry,FileAgent,ProjectAgent,PreviewAgent,InstructionsAgent,SchedulingAgent,TwitterAgent agentNode
    class ConvexDB,Projects,Files,Users,Guidelines dataNode
    class UIStore,EditorStore,SidebarStore,IdentityStore stateNode
    class PreviewBtn,PreviewToggle,LoadGuidelines,GeneratePreview,DisplayPreview previewNode